{% extends 'base_front.html.twig' %}

{% block body %}

<style>
.organisation-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
}

.organisation-image {
    width: 100%;
    height: 200px; /* Adjust the height as needed */
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 20px;
}

.organisation-details h3 {
    font-size: 20px;
    margin-bottom: 10px;
}

.organisation-details .organisation-description {
    font-size: 16px;
    margin-bottom: 20px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3; /* Limit to 3 lines */
    -webkit-box-orient: vertical;
}

.btn-donate {
    background-color: #fdd835; /* Yellow color */
    color: #333; /* Text color */
    border: none;
}

.btn-donate:hover {
    background-color: #ffee58; /* Lighter yellow color on hover */
}

</style>

    <!-- Start Hero Section -->
    <div class="hero">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-5">
                    <div class="intro-excerpt">
                        <h1>Organisations</h1>
                        <p class="mb-4">Il existe une variété d'organisations à but non lucratif qui acceptent les dons pour soutenir diverses causes humanitaires, environnementales, sociales et éducatives. Ces organisations fournissent une assistance directe aux populations dans le besoin, œuvrent pour la préservation de l'environnement, défendent les droits de l'homme, soutiennent la recherche médicale et scientifique, promeuvent l'éducation et le développement communautaire, entre autres. En contribuant financièrement ou en nature à ces initiatives, les donateurs jouent un rôle crucial dans la promotion du bien-être collectif et dans la résolution des défis auxquels notre société est confrontée. Chaque don, quel que soit son montant, contribue à faire une réelle différence et à créer un impact positif dans le monde.</p>
              <!--          <p><a href="" class="btn btn-secondary me-2">Shop Now</a><a href="#" class="btn btn-white-outline">Explore</a></p>
                -->    </div>
                </div>
                <div class="col-lg-7">
                    <div class="hero-img-wrap">
                        <img src="images/couch.png" class="img-fluid">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Hero Section -->

    <!-- Start Organisation Section -->
    <div class="organisation-section">
        <div class="container">
        <div class="row justify-content-center"> <!-- Center the search bar -->
            <div class="col-md-6">
                <form action="{{ path('app_organisation_search') }}" method="GET" class="text-center"> <!-- Add text-center class -->
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="Rechercher des organisations..." name="query">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit">Rechercher</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>  
            <div class="row my-5">
                {% for organisation in organisations %}
                    <div class="col-6 col-md-6 col-lg-3 mb-4">
                        <div class="organisation-card">
                            <img src="{{ asset('uploads/organisations/' ~ organisation.imageOrganisation) }}" alt="{{ organisation.nomOrganisation }}" class="img-fluid organisation-image">
                            <div class="organisation-details">
                                <h6>{{ organisation.nomOrganisation }}</h6>
                                <p class="organisation-description">{{ organisation.description|slice(0, 100) }}</p>
                                <a href="{{ path('app_donate_to_organisation', {'id': organisation.id}) }}" class="btn btn-yellow btn-block btn-donate">Donate</a> 
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
<div class="col-md-8">
    <div id="map" style="height: 600px; width: 1500px;"></div>


    <script src="https://cdn.jsdelivr.net/npm/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // Function to extract coordinates from Google Maps URL
        function extractCoordinatesFromGoogleMapsUrl(googleMapsUrl) {
            // Extracting coordinates from the URL
            var matches = googleMapsUrl.match(/@(-?\d+\.\d+),(-?\d+\.\d+),(\d+)z/);

            if (matches && matches.length === 4) {
                var latitude = parseFloat(matches[1]);
                var longitude = parseFloat(matches[2]);
                return [latitude, longitude];
            } else {
                console.error('Error parsing Google Maps URL');
                return null;
            }
        }

        // Set up the Leaflet map
        var map = L.map('map').setView([36.8065, 10.1815], 8);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Loop through organizations
        {% for organisation in organisations %}
            var organ = '{{ organisation.adresse }}'; 
            var coordinates = extractCoordinatesFromGoogleMapsUrl(organ);

            if (coordinates) {
                // Add a marker to the map
                L.marker(coordinates).addTo(map)
                    .bindPopup('hello')
                    .openPopup();
            } else {
                console.error('Error extracting coordinates for organization: hello');
            }
        {% endfor %}
    </script>
</div>


{% endblock %}
